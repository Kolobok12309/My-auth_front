(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["profile"],{"0202":function(e,t,n){"use strict";n("b5b2")},"17c0":function(e,t,n){"use strict";var r=n("7a23"),a=Object(r["withScopeId"])("data-v-e13a1f92");Object(r["pushScopeId"])("data-v-e13a1f92");var o={class:"date"};Object(r["popScopeId"])();var c=a((function(e,t,n,a,c,i){return Object(r["openBlock"])(),Object(r["createBlock"])("span",o,Object(r["toDisplayString"])(e.text),1)})),i=(n("a9e3"),{props:{value:{type:[Number,String,Date],default:null}},computed:{text:function(){if(!this.value)return"Не указана";var e=new Date(this.value);return e.toLocaleString()}}});n("3fd1");i.render=c,i.__scopeId="data-v-e13a1f92";t["a"]=i},"1de2":function(e,t,n){"use strict";n.r(t);var r=n("7a23"),a=Object(r["withScopeId"])("data-v-06d2d2ba");Object(r["pushScopeId"])("data-v-06d2d2ba");var o={class:"user-page p-grid p-mx-0"},c={class:"p-col-12 p-md-4 p-xl-2 p-offset-0 p-xl-offset-2"},i=Object(r["createTextVNode"])(" Информация "),s=Object(r["createTextVNode"])(" E-mail: "),u=Object(r["createTextVNode"])(" Отдел: "),d={class:"user-page__center p-col-12 p-md-8 p-xl-6"},l={class:"user-page__center__content"};Object(r["popScopeId"])();var p=a((function(e,t,n,p,b,m){var f=Object(r["resolveComponent"])("SkeletonHelper"),O=Object(r["resolveComponent"])("Divider"),j=Object(r["resolveComponent"])("GroupView"),g=Object(r["resolveComponent"])("RoleView"),v=Object(r["resolveComponent"])("Card"),h=Object(r["resolveComponent"])("Menubar"),k=Object(r["resolveComponent"])("router-view"),V=Object(r["resolveComponent"])("SpinnerHelper");return Object(r["openBlock"])(),Object(r["createBlock"])("div",o,[Object(r["createVNode"])("div",c,[Object(r["createVNode"])(v,null,{title:a((function(){return[i]})),content:a((function(){return[Object(r["createVNode"])(f,{pending:e.pending},{default:a((function(){return[Object(r["createTextVNode"])(" Логин: "+Object(r["toDisplayString"])(e.user.username),1)]})),_:1},8,["pending"]),Object(r["createVNode"])(O),Object(r["createVNode"])(f,{pending:e.pending},{default:a((function(){return[s,Object(r["createVNode"])("a",{href:"mailto:"+e.user.email},Object(r["toDisplayString"])(e.user.email),9,["href"])]})),_:1},8,["pending"]),Object(r["createVNode"])(O),Object(r["createVNode"])(f,{pending:e.pending},{default:a((function(){return[e.user.group?(Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],{key:0},[u,Object(r["createVNode"])(j,{group:e.user.group},null,8,["group"])],64)):Object(r["createCommentVNode"])("",!0)]})),_:1},8,["pending"]),e.pending||e.user.group?(Object(r["openBlock"])(),Object(r["createBlock"])(O,{key:0})):Object(r["createCommentVNode"])("",!0),Object(r["createVNode"])(f,{pending:e.pending},{default:a((function(){return[Object(r["createVNode"])(g,{value:e.user.role},null,8,["value"])]})),_:1},8,["pending"])]})),_:1})]),Object(r["createVNode"])("div",d,[Object(r["createVNode"])(h,{model:e.toolbarItems,class:"p-mb-3"},null,8,["model"]),Object(r["createVNode"])("div",l,[Object(r["createVNode"])(V,{pending:e.pending,class:"p-mx-auto p-mt-6"},{default:a((function(){return[Object(r["createVNode"])(k,{user:e.user,isMe:e.isMe,pending:e.pending,onUpdate:e.onUpdate},{default:a((function(t){var n=t.Component;return[(Object(r["openBlock"])(),Object(r["createBlock"])(r["KeepAlive"],{max:"2"},[(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])(n),{key:e.$route.fullPath}))],1024))]})),_:1},8,["user","isMe","pending","onUpdate"])]})),_:1},8,["pending"])])])])})),b=(n("a9e3"),n("3835")),m=(n("96cf"),n("1da1")),f=n("5530"),O=n("f31b"),j=n.n(O),g=n("5502"),v=n("be3b"),h=n("c24f"),k=n("a7ca"),V=n.n(k),w=n("0596"),x=n.n(w),N=n("a0cd"),C=n.n(N),y=n("3635"),I=n("08bd"),S=n("4ecd"),B=n("be88"),D={Card:V.a,Divider:x.a,Menubar:C.a,RoleView:y["a"],SkeletonHelper:I["a"],SpinnerHelper:S["a"],GroupView:B["a"]},T={name:"UserPage",components:D,props:{id:{type:Number,required:!0}},data:function(){return{user:null,pending:!0}},computed:Object(f["a"])(Object(f["a"])(Object(f["a"])({},Object(g["d"])("user",{myId:"id"})),Object(g["c"])("user",["isAdmin"])),{},{isMe:function(){return this.id===this.myId},toolbarItems:function(){var e=this,t=this.id;return[{label:"Профиль",icon:"pi pi-user",to:"/user/".concat(t,"/profile")},{label:"Настройки",icon:"pi pi-cog",to:"/user/".concat(t,"/settings"),visible:function(){return e.isMe||e.isAdmin}}]}}),methods:{onUpdate:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,j()(Object(h["c"])(v["a"],e.id));case 2:if(n=t.sent,r=Object(b["a"])(n,2),a=r[0],o=r[1],!a){t.next=9;break}return e.$toast.add({severity:"error",summary:a.serverError||"Ошибка обновления информации о пользователе",life:5e3}),t.abrupt("return");case 9:e.user=o,e.isMe&&e.$store.commit("user/setUser",o);case 11:case"end":return t.stop()}}),t)})))()}},beforeRouteEnter:function(e,t,n){return Object(m["a"])(regeneratorRuntime.mark((function t(){var r,a,o,c,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.params.id,t.next=3,j()(Object(h["c"])(v["a"],r));case 3:if(a=t.sent,o=Object(b["a"])(a,2),c=o[0],i=o[1],!c){t.next=10;break}return console.error(c),t.abrupt("return",n(!1));case 10:n((function(e){e.user=i,e.pending=!1}));case 11:case"end":return t.stop()}}),t)})))()},beforeRouteUpdate:function(e,t,n){var r=this;return Object(m["a"])(regeneratorRuntime.mark((function a(){var o,c,i,s,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=e.params.id,o!==t.params.id){a.next=3;break}return a.abrupt("return",n());case 3:return r.pending=!0,a.next=6,j()(Object(h["c"])(v["a"],o));case 6:c=a.sent,i=Object(b["a"])(c,2),s=i[0],u=i[1],r.pending=!1,s?(console.error(s),n(!1)):(r.user=u,n());case 12:case"end":return a.stop()}}),a)})))()}};n("34c9");T.render=p,T.__scopeId="data-v-06d2d2ba";t["default"]=T},"34c9":function(e,t,n){"use strict";n("47e2")},"3fd1":function(e,t,n){"use strict";n("a8f5")},"47e2":function(e,t,n){},"4c42":function(e,t,n){"use strict";n("955f")},9501:function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,o,c){var i=Object(r["resolveComponent"])("SettingsForm"),s=Object(r["resolveComponent"])("TokensTable");return Object(r["openBlock"])(),Object(r["createBlock"])("div",null,[Object(r["createVNode"])(i,{user:e.user,isMe:e.isMe,pending:e.settingsPending,onSubmit:e.onSettingsUpdate},null,8,["user","isMe","pending","onSubmit"]),Object(r["createVNode"])(s,{tokens:e.tokens,pending:e.tokensPending,class:"p-mt-3",onDelete:e.onTokenDelete},null,8,["tokens","pending","onDelete"])])}n("c975"),n("a434");var o=n("3835"),c=(n("96cf"),n("1da1")),i=n("f31b"),s=n.n(i),u=n("c24f"),d=Object(r["withScopeId"])("data-v-7fa455a4");Object(r["pushScopeId"])("data-v-7fa455a4");var l=Object(r["createTextVNode"])(" Настройки "),p={class:"settings-form__grid"},b=Object(r["createVNode"])("label",{for:"email"}," Email: ",-1),m=Object(r["createVNode"])("label",{for:"group"}," Отдел: ",-1),f=Object(r["createVNode"])("label",{for:"role"}," Роль: ",-1),O={class:"p-grid p-mt-2"},j={class:"p-col-fixed"};Object(r["popScopeId"])();var g=d((function(e,t,n,a,o,c){var i=Object(r["resolveComponent"])("InputText"),s=Object(r["resolveComponent"])("GroupPicker"),u=Object(r["resolveComponent"])("RolePicker"),g=Object(r["resolveComponent"])("Button"),v=Object(r["resolveComponent"])("Card");return Object(r["openBlock"])(),Object(r["createBlock"])(v,null,{title:d((function(){return[l]})),content:d((function(){return[Object(r["createVNode"])("form",{class:"settings-form",onSubmit:t[4]||(t[4]=Object(r["withModifiers"])((function(){return e.onSubmit&&e.onSubmit.apply(e,arguments)}),["prevent"]))},[Object(r["createVNode"])("div",p,[b,Object(r["createVNode"])("div",null,[Object(r["createVNode"])(i,{modelValue:e.userData.email,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.userData.email=t}),disabled:e.pending,id:"email",placeholder:"example@example.com",type:"text"},null,8,["modelValue","disabled"])]),m,Object(r["createVNode"])("div",null,[Object(r["createVNode"])(s,{modelValue:e.userData.groupId,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.userData.groupId=t}),disabled:e.pending,inputId:"group"},null,8,["modelValue","disabled"])]),e.showRoles?(Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],{key:0},[f,Object(r["createVNode"])("div",null,[Object(r["createVNode"])(u,{modelValue:e.userData.role,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.userData.role=t}),disabled:e.pending,inputId:"role"},null,8,["modelValue","disabled"])])],64)):Object(r["createCommentVNode"])("",!0)]),Object(r["createVNode"])("div",O,[Object(r["createVNode"])("div",j,[Object(r["createVNode"])(g,{disabled:e.pending,label:"Сохранить",icon:"pi pi-save",type:"submit"},null,8,["disabled"])])])],32)]})),_:1})})),v=n("5530"),h=n("5502"),k=n("a7ca"),V=n.n(k),w=n("a84a"),x=n.n(w),N=n("6549"),C=n.n(N),y=n("a871"),I=n("5c09"),S={Card:V.a,InputText:x.a,Button:C.a,GroupPicker:y["a"],RolePicker:I["a"]},B={components:S,props:{user:{type:Object,required:!0},isMe:{type:Boolean,default:!1},pending:{type:Boolean,default:!1}},emits:["submit"],data:function(){return{userData:null}},computed:Object(v["a"])(Object(v["a"])({},Object(h["c"])("user",["isAdmin"])),{},{userIsAdmin:function(){return 0===this.user.role},showRoles:function(){return this.isAdmin&&(this.isMe||!this.userIsAdmin)}}),watch:{user:{handler:"resetUserData",immediate:!0}},methods:{resetUserData:function(){var e=this.user,t=e.email,n=e.groupId,r=void 0===n?null:n,a=e.role,o=void 0===a?2:a;this.userData={email:t,groupId:r,role:o}},onSubmit:function(){var e=Object(v["a"])({},this.userData);this.showRoles||delete e.role,this.$emit("submit",e)}}};n("4c42");B.render=g,B.__scopeId="data-v-7fa455a4";var D=B,T=Object(r["createVNode"])("div",{class:"p-text-center"}," Токены не найдены ",-1);function P(e,t,n,a,o,c){var i=Object(r["resolveComponent"])("Column"),s=Object(r["resolveComponent"])("DateView"),u=Object(r["resolveComponent"])("DataTable");return Object(r["openBlock"])(),Object(r["createBlock"])(u,{title:"Список токенов доступа",items:e.tokens,pending:e.pending,paginator:!1,class:"tokens-table"},{empty:Object(r["withCtx"])((function(){return[T]})),default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(i,{field:"id",header:"#",headerClass:"p-text-center",bodyClass:"p-text-center"}),Object(r["createVNode"])(i,{field:"userAgent",header:"UserAgent",bodyClass:"tokens-table__user-agent"}),Object(r["createVNode"])(i,{field:"ip",header:"Ip-адрес"}),Object(r["createVNode"])(i,{field:"createdAt",header:"Дата"},{body:Object(r["withCtx"])((function(e){var t=e.data;return[Object(r["createVNode"])(s,{value:t.createdAt},null,8,["value"])]})),_:1}),Object(r["createVNode"])(i,{field:"actions",header:"#"},{body:Object(r["withCtx"])((function(t){var n=t.data;return[Object(r["createVNode"])("i",{class:"pi pi-trash",onClick:Object(r["withModifiers"])((function(t){return e.onDelete(n)}),["stop"])},null,8,["onClick"])]})),_:1})]})),_:1},8,["items","pending"])}var R=n("c524"),_=n.n(R),M=n("0dd2"),U=n("17c0"),$={components:{Column:_.a,DataTable:M["a"],DateView:U["a"]},props:{tokens:{type:Array,default:function(){return[]}},pending:{type:Boolean,default:!1}},emits:["delete"],methods:{onDelete:function(e){this.$emit("delete",e)}}};n("0202");$.render=P;var A=$,E={components:{SettingsForm:D,TokensTable:A},props:{user:{type:Object,required:!0},isMe:{type:Boolean,required:!0}},emits:["update"],data:function(){return{tokens:[],tokensPending:!0,settingsPending:!1}},methods:{loadTokens:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,a,c,i,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.isMe?u["b"]:u["d"],e.tokensPending=!0,t.next=4,s()(n(e.$axios,e.user.id));case 4:if(r=t.sent,a=Object(o["a"])(r,2),c=a[0],i=a[1],d=void 0===i?[]:i,!c){t.next=13;break}return e.$toast.add({severity:"error",summary:c.serverError||"Ошибка загрузки токенов",life:5e3}),e.tokensPending=!1,t.abrupt("return");case 13:e.tokens=d,e.tokensPending=!1;case 15:case"end":return t.stop()}}),t)})))()},onTokenDelete:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,a,c,i,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.id,t.tokensPending=!0,n.next=4,s()(Object(u["g"])(t.$axios,r));case 4:if(a=n.sent,c=Object(o["a"])(a,1),i=c[0],!i){n.next=11;break}return t.$toast.add({severity:"error",summary:i.serverError||"Ошибка при удалении токена",life:5e3}),t.tokensPending=!1,n.abrupt("return");case 11:d=t.tokens.indexOf(e),~d&&t.tokens.splice(d,1),t.$toast.add({severity:"success",summary:"Токен успешно удалён",life:5e3}),t.tokensPending=!1;case 15:case"end":return n.stop()}}),n)})))()},onSettingsUpdate:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,a,c,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.user.id,t.settingsPending=!0,n.next=4,s()(Object(u["l"])(t.$axios,r,e));case 4:if(a=n.sent,c=Object(o["a"])(a,1),i=c[0],!i){n.next=11;break}return t.$toast.add({severity:"error",summary:i.serverError||"Ошибка при изменении настроек",life:5e3}),t.settingsPending=!1,n.abrupt("return");case 11:t.$toast.add({severity:"success",summary:"Настройки успешно изменены",life:5e3}),t.$emit("update"),t.settingsPending=!1;case 14:case"end":return n.stop()}}),n)})))()}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadTokens();case 2:case"end":return t.stop()}}),t)})))()}};E.render=a;t["default"]=E},"955f":function(e,t,n){},a8f5:function(e,t,n){},b5b2:function(e,t,n){},ed22:function(e,t,n){"use strict";n.r(t);n("4de4");var r=n("7a23"),a={class:"profile"};function o(e,t,n,o,c,i){var s=Object(r["resolveComponent"])("TaskFilter"),u=Object(r["resolveComponent"])("TaskTable");return Object(r["openBlock"])(),Object(r["createBlock"])("div",a,[Object(r["createVNode"])(s,{pending:e.pending,title:e.filter.title,"onUpdate:title":t[1]||(t[1]=function(t){return e.filter.title=t}),status:e.filter.status,"onUpdate:status":t[2]||(t[2]=function(t){return e.filter.status=t}),groupId:e.filter.groupId,"onUpdate:groupId":t[3]||(t[3]=function(t){return e.filter.groupId=t}),hideGroup:e.hasGroup,hideUser:"",onSubmit:e.onFilter},null,8,["pending","title","status","groupId","hideGroup","onSubmit"]),Object(r["createVNode"])(u,{title:e.tableTitle,tasks:e.tasks,pending:e.pending,page:e.meta&&e.meta.page,perPage:e.meta&&e.meta.perPage,totalCount:e.meta&&e.meta.totalCount,class:"p-mt-3",onPage:e.onChangePage},null,8,["title","tasks","pending","page","perPage","totalCount","onPage"])])}var c=n("3835"),i=n("5530"),s=(n("96cf"),n("1da1")),u=n("f31b"),d=n.n(u),l=n("6925"),p=n("ca0e"),b=n("b199"),m={components:{TaskFilter:l["a"],TaskTable:p["a"]},props:{user:{type:Object,required:!0},isMe:{type:Boolean,required:!0}},data:function(){return{pending:!0,tasks:[],meta:null,filter:{title:"",status:null,userId:null,groupId:null}}},computed:{tableTitle:function(){return this.isMe?"Мои задачи":"Задачи"},hasGroup:function(){return null!==this.user.groupId}},watch:{user:{handler:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.id,a=e.groupId,t.filter.userId=r,a&&(t.filter.groupId=a),n.next=5,t.loadTasks();case 5:case"end":return n.stop()}}),n)})))()},immediate:!0}},methods:{onFilter:function(){this.loadTasks()},onChangePage:function(e){this.loadTasks(e.page+1,e.rows)},loadTasks:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,a,o,s,u,l,p,m,f,O;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:1,a=e.length>1&&void 0!==e[1]?e[1]:20,o=Object(i["a"])(Object(i["a"])({},t.filter),{},{page:r,perPage:a}),t.pending=!0,n.next=6,d()(Object(b["e"])(t.$axios,o));case 6:if(s=n.sent,u=Object(c["a"])(s,2),l=u[0],p=u[1],p=void 0===p?{}:p,m=p.items,f=p.meta,O=void 0===f?null:f,!l){n.next=16;break}return t.$toast.add({severity:"error",summary:l.serverError||"Ошибка загрузки задач",life:5e3}),t.pending=!1,n.abrupt("return");case 16:t.tasks=m,t.meta=O,t.pending=!1;case 19:case"end":return n.stop()}}),n)})))()}}};m.render=o;t["default"]=m}}]);
//# sourceMappingURL=profile.871582a3.js.map